@using SweetSerenityBySarah
@using SweetSerenityBySarah.Models
@model SweetSerenityBySarah.Models.PaymentFormModel
@{

    //var model = new PaymentFormModel();

    <hr>
    <h4 class="intro-text text-center">
        Payment Details...
    </h4>
    <hr>

    if (TempData.ContainsKey("paymentSuccess"))
    {
    var successMessage = (string)TempData["paymentSuccess"];
        <div role="alert" class="alert alert-success alert-dismissible fade in">
            <button aria-label="Close" data-dismiss="alert" class="close" type="button">
                <span aria-hidden="true">&times;</span>
            </button>
            <p>@Html.Raw(successMessage)</p>
        </div>
    }
    else
        {

        if (TempData.ContainsKey("paymentError"))
            {
            var errorMessage = (string)TempData["paymentError"];
            <div role="alert" class="alert alert-danger alert-dismissible fade in">
                <button aria-label="Close" data-dismiss="alert" class="close" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
                <p>@Html.Raw(errorMessage)</p>
            </div>
            }

        using (Html.BeginUmbracoForm("ProcessPaymentForm", "PaymentSurface", FormMethod.Post, new { @class = "form-horizontal", role = "form", id = "cardDetailsForm" }))
            {

            if (Model.IsUserAdmin)
                {
                <div class="form-group">
                    @Html.LabelFor(m => m.MemberId, new {@class = "control-label col-sm-4"})

                    <div class="col-sm-8">
                        @Html.DropDownListFor(m => m.MemberId, new SelectList(Model.SiteMembers, "Id", "Email"), new {@class = "form-control"})
                        @Html.HiddenFor(m => m.MemberEmailAddress)
                    </div>
                </div>
            }

            <div class="form-group">
                @Html.LabelFor(m => m.PaymentAmount, new {@class = "control-label col-sm-4"})

                <div class="col-sm-4">
                    @Html.TextBoxFor(m => m.PaymentAmount, new {@class = "form-control", required = "", placeholder = "Enter the amount you wish to pay"})
                    @Html.ValidationMessageFor(m => m.PaymentAmount, "", new {@class = "text-danger"})
                </div>

                <div class="form-group col-sm-4 text-right">
                    <script src="https://checkout.stripe.com/checkout.js"
                            class="stripe-button"
                            data-key="@Model.PublishApiKey"
                            data-amount="@Model.PaymentAmount"
                            data-email="@Model.MemberEmailAddress"
                            data-name="Sweet Serenity by Sarah"
                            data-description="Treatment payment"
                            data-billing-address="true"
                            data-image="/Images/SSS_Logo_Square.png"
                            data-locale="auto"
                            data-currency="aud"
                            data-label="Card Payment">
                    </script>
                </div>
            </div>
        }
    }
}
